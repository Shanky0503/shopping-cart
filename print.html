<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.4/angular.min.js"></script>
    <script type="text/javascript" src="js/dependencies/rsvp-3.1.0.min.js"></script>
    <script type="text/javascript" src="js/dependencies/sha-256.min.js"></script>
    <script type="text/javascript" src="js/qz-tray.js"></script>
    <script src="js/app.js"></script>
    <title>print Test</title>
    <script type="text/javascript">
    var printerName;
    // var cart;
    (function(){
      console.log("THE function is running");
      qz.websocket.connect().then(function() {
         alert("Connected!");
      });
      console.log(loadDataFromStorage());
    })();

    function findPrinters() {
      qz.printers.find("EPSON").then(function(found) {
        // console.log("printers");
        alert("Printer: " + found);
        // printerName = found;
        printPos(found);

      });
    }

    function loadDataFromStorage (){
      var loadedData = JSON.parse(localStorage.getItem("shoppingCart"));
      return loadedData;
        }

    // function print(name){
    //   var config = qz.configs.create(name);               // Exact printer name from OS
    //   var data = ['^XA^FO50,50^ADN,36,20^FDRAW ZPL EXAMPLE^FS^XZ'];   // Raw commands (ZPL provided)
    //   qz.print(config, data).then(function() {
    //     return qz.print(config, data);
    //   });
    // }
    function printPos (name){
    var config = qz.configs.create(name);

        var data = [
           '\x1B' + '\x40',          // init
           '\x1B' + '\x61' + '\x31', // center align
           'Beverly Hills, CA  90210' + '\x0A',
           '\x0A',                   // line break
           'www.qz.io' + '\x0A',     // text and line break
           '\x0A',                   // line break
           '\x0A',                   // line break
           'May 18, 2016 10:30 AM' + '\x0A',
           '\x0A',                   // line break
           '\x0A',                   // line break
           '\x0A',
           'Transaction # 123456 Register: 3' + '\x0A',
           '\x0A',
           '\x0A',
           '\x0A',
           '\x1B' + '\x61' + '\x30', // left align
           'Baklava (Qty 4)       9.00' + '\x1B' + '\x74' + '\x13' + '\xAA', //print special char symbol after numeric
           '\x0A',
           'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX' + '\x0A',
           '\x1B' + '\x45' + '\x0D', // bold on
           'Here\'s some bold text!',
           '\x0A',
           '\x1B' + '\x45' + '\x0A', // bold off
           '\x1D' + '\x21' + '\x11', // double font size
           'Here\'s large text!',
           '\x0A',
           '\x1D' + '\x21' + '\x00', // standard font size
           '\x1B' + '\x61' + '\x32', // right align
           '\x1B' + '\x21' + '\x30', // em mode on
           'DRINK ME',
           '\x1B' + '\x21' + '\x0A' + '\x1B' + '\x45' + '\x0A', // em mode off
           '\x0A' + '\x0A',
           '\x1B' + '\x61' + '\x30', // left align
           '------------------------------------------' + '\x0A',
           '\x1B' + '\x4D' + '\x31', // small text
           'EAT ME' + '\x0A',
           '\x1B' + '\x4D' + '\x30', // normal text
           '------------------------------------------' + '\x0A',
           'normal text',
           '\x1B' + '\x61' + '\x30', // left align
           '\x0A' + '\x0A' + '\x0A' + '\x0A' + '\x0A' + '\x0A' + '\x0A',
           '\x1B' + '\x69',          // cut paper
           '\x10' + '\x14' + '\x01' + '\x00' + '\x05',  // Generate Pulse to kick-out cash drawer**
                                                        // **for legacy drawer cable CD-005A.  Research before using.
        ];

        qz.print(config, data).catch(function(e) { console.error(e); });
    }

    function totalPrint (){
      qz.websocket.connect().then(function() {
         return qz.printers.find("zebra")               // Pass the printer name into the next Promise
      }).then(function(printer) {
         var config = qz.configs.create(printer);       // Create a default config for the found printer
         var data = ['^XA^FO50,50^ADN,36,20^FDRAW ZPL EXAMPLE^FS^XZ'];   // Raw ZPL
         return qz.print(config, data);
      }).catch(function(e) { console.error(e); });
    }
    </script>
  </head>
  <body  ng-app="app" ng-Controller="StoreController as storeCtrl">
    <div class="sidelist-holder" ng-show="menuCtrl.table[menuCtrl.tableNo-1].occupied">
      <ul id="show-cart">
        <li id="sidelist" class="side-items" ng-repeat="order in menuCtrl.table[menuCtrl.tableNo-1].orders">
          {{order.name}}
          <button ng-click="menuCtrl.removeOne(order)">-</button>
          {{order.quantity}}
          <button ng-click="menuCtrl.addOne(order)">+</button>
          =
          {{order.price | currency}}
          <button ng-click="menuCtrl.removeItem(order)">X</button>
        </li>
      </ul>
      <div> You have {{menuCtrl.getItems(menuCtrl.table[menuCtrl.tableNo-1].orders)}} items in your cart</div>
      <div> Total Cart: {{menuCtrl.getTotal(menuCtrl.table[menuCtrl.tableNo-1]) | currency}}</div>
      <div>
        <button id="clear-cart" ng-click="menuCtrl.clearCart()">Clear cart</button>
        <!-- <button id="print" ng-click="menuCtrl.printBill()">print</button> -->
        <button id="print"><a href="print.html">Print</a></button>
      </div>
    </div>
    <button type="button" name="button" ng-click="menuCtrl.printBill()">print</button>
  </body>
</html>
